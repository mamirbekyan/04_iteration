---
title: "Assignment 4 - Iteration"
author: "Mari Amirbekyan"  
format:
  html:
    code-fold: true 
    embed-resources: true
    toc: true
    number-sections: true
    theme: cerulean
---
<style>
  h1 { color: blue; }   /* Makes all H1 headings blue */
  h2 { color: cornflowerblue}

</style>

# Goal of this assignment  
The goal of this assignment is for you to **apply different iteration concepts** learned in class to a new data set.  

In specific, you will be asked to:  
  - create a function to automate plot creation  
  - apply this function to different parts of a dataset through the use of the map function.  

# Instructions  
  - Move this script into the `code` subfolder of your `04_iteration` project  
  - On this script, fill your name under the `title` section of the YAML  
  - On this script, you will be asked to:  
    - Import the raw soybeans data set used in the `02_wrangling` project  
    - Create a function to automate the creation of boxplots  
    - Create a map workflow to apply your function to different locations in the data set  
    
# Code  
Hereafter is where you will develop your code.  
Remember to load any necessary packages and the data.  

**Setup**
```{r setup, message=TRUE, warning=FALSE}
#| message: false 
#| warning: false

# Loading packages
library(tidyverse) # for data wrangling and plotting. Has purrr functions (the maps)
library(janitor) # clean column names
library(knitr) # for figure displaying
library(readxl) # to read excel files
library(ggplot2) #to make the boxplot
```
  
**Loading Data**
```{r}
soyk <- read_excel("../data/01_soybeans.xlsx")
view(soyk) #so I can see it in a separate tab easily
soyk #so I can see it as a tibble inline with script
```

**Playing with the Data**
```{r}
#The goal will be to make a general function that shows a box plot for each K rate, 
#where the plot shows distribution of measured leaf potassium levels for each 
#applied concentration.

soyk_1 <- clean_names(soyk) 

soyk_1
```


## Q1 - Create a function  
Here, you are asked to create a function.  
The goal of this function is to create a box plot of K leaf concentration as a function of K rates.    
Name the function `myplot`.  
The function inputs are:  
  - df: the data set containing the columns needed for plotting  
  - x: the column name inside df to be plotted on the x axis  
  - y: the column name inside df to be plotted on the y axis  

Once you create the function, make sure it works by applying it to one of the locations where K leaf concentration was collected.  

**Practice Making a Boxplot**
```{r}
#First, making a simple, direct example boxplot for a location and different k rates 
#(to see what the function output should look like):
ggplot(soyk_1,
       aes(x = factor (k_rate_lbac), 
           y = tifton_k_pct)) +
      geom_boxplot() +
      geom_point() +
      labs(x = "K Rate (lb/ac)",
           y = "Potassium Leaf Concentration (%)")

``` 
Note: The x-axis data is dbl. we want it to separate by value like it would as a character, 
but not SORT alphabetically as it does for characters (which ended up being 0,100,150,50). 
So we write "factor" before the x-axis column name. 
However, because ggplot is very literal, it doesnt see factor() as a "function" 
but makes it the automatic x-axis label. So we should also define axis labels. 
We dont need to use factor() for x axis because it is continuous data.

**Creating the Function and Making sure it works**
```{r}
myplot <- function(df, x, y) {
  ggplot(df,
       aes(x = factor({{x}}), #Double curly brackets are for the changing variable
           y = {{y}})) +
      geom_boxplot() +
      geom_point() +
      labs(x = "K Rate (lb/ac)",
           y = "Potassium Leaf Concentration (%)")
}      

myplot(soyk_1, k_rate_lbac, tifton_k_pct)
```


## Q2 - Iterate over locations  
On the step above you created a function to create boxplot for one location (one column in your original data set).  

Now, you are asked to apply this function to each location in the data set.  
For that, use one of the functions in the `map` family from the purr package.  
When making your plots, make sure to add a title to represent which location is represented in each plot.  

**Using that Function to Iterate Over Locations**
```{r}
#Note: We only have a single iterating element - the location. 
#So, we use the map(x) function.
#I changed it to .data[[]] because y changes, and {{}} didnt work with paste()

myplot2 <- function(df, x, y) {
  ggplot(df, 
         aes(x = factor({{ x }}), 
             y = .data[[y]])) + 
    geom_boxplot() +
    geom_point() +
    labs(title = paste("Location:", y), #because we want it to take y's titles
         x = "K Rate (lb/ac)",
         y = "Potassium Leaf Concentration (%)")
}
```

```{r}
locations <- soyk_1 %>%
  select(tifton_k_pct:macon_k_pct) %>%
  names() 
#names(soyk_1) lists the column headers as the output of the locations object


iterated_boxplots <- map(locations, #asking it to remember the global object first
                 ~myplot2(soyk_1, k_rate_lbac, .x)) 

iterated_boxplots


```
The dataset here is soyk_1, the k_rate_lbac does not change so we call it as it is as a component of the function we made, but .x is the thing we are iterating over. When we call .x in the map(), its iterating over a global object I created for locations from the data, and inputting them into ~myplot2 one by one. The alternative would be to use pivot longer and make a locations column, then it would iterate over different locations in a single column, instead of iterating over row names. This method right now works well because we only have 4 row names, and they're in order in our data. If we had more, we'd maybe want to pivot instead.

Within ~myplot2(): It matches the order we made in the myplot2 function: 

soyk_1 = df
      
k_rate_lbac = x
      
.x = y (the iterative component: .x is the placeholder for what map() will pick out of soyk_1 from locations and apply that to the function. If I had used pivot_longer, "locations" would just be the name of the column I'm iterating .x over.)
      
      

# Submitting your work  
Once you have developed all the code and answers, make sure to Render this quarto file.  

**Notes on rendering**:  

- Make sure to render your work and inspect how the final html looks like.  
- If it does not look professional for whatever reason, then fix the issue, re-render it, recheck.  
- Only send me your work once your html file looks professional.  
  - **DO NOT** delete the file's heading levels (# and ##). They set up the proper heading 1 and 2 levels, and I use them to guide my grading.  
  - If a given chunk is also outputting warnings or messages, inhibit this behavior by changing the chunk options `message` and `warning` to `FALSE` (I'll demo this in a moment).  
  
  - If, after rendered, 2 lines of text are connected and you wish to "break line" between them, add 2 extra spaces after the first one (I'lld demo this in a moment).  

After rendering, an .html file will be created on your `code` folder.  

Rename this file to `Assignment-04-iteration-LASTNAME.html`.    

For ex., mine would be `Assignment-04-iteration-Bastos.html`.

Submit your work by uploading the **html** file to **eLC Assignment #4 - Iteration** by Feb 16 11:59 pm.  
  




